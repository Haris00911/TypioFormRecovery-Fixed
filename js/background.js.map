{"version":3,"file":"background.js","mappings":"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","sources":["webpack://typio-form-recovery/./src/js/controllers/background/contextMenuController.js","webpack://typio-form-recovery/./src/js/controllers/background/listenerController.js","webpack://typio-form-recovery/./src/js/controllers/background/splashController.js","webpack://typio-form-recovery/webpack/bootstrap","webpack://typio-form-recovery/./src/js/modules/options/defaultOptions.js","webpack://typio-form-recovery/./src/js/controllers/background/maintenanceController.js","webpack://typio-form-recovery/./src/js/controllers/background/backgroundController.js"],"sourcesContent":["(function() {\n\t// Only add context menus on install\n\tchrome.runtime.onInstalled.addListener(() => {\n\t\tchrome.storage.sync.get('hideContextItems', function(obj) {\n\t\t\tif(obj.hideContextItems !== true) {\n\t\t\t\tcreateContextMenus();\n\t\t\t}\n\t\t})\n\t})\n\n\n\t// React to changes\n\tchrome.storage.onChanged.addListener(function(changes, namespace) {\n\t\tif(changes.hideContextItems && changes.hideContextItems.newValue === true) {\n\t\t\tchrome.contextMenus.removeAll();\n\n\t\t} else if(changes.hideContextItems && changes.hideContextItems.newValue === false) {\n\t\t\tcreateContextMenus();\n\t\t}\n\t})\n\n\tfunction createContextMenus() {\n\t\tchrome.contextMenus.create({\n\t\t\tid: 'recoverEditable',\n\t\t\ttitle : 'Recover this field',\n\t\t\tcontexts : ['editable']\n\t\t});\n\n\t\tchrome.contextMenus.create({\n\t\t\tid: 'openRecoveryDialog',\n\t\t\ttitle : 'Open form recovery',\n\t\t\tcontexts : ['all']\n\t\t});\n\t}\n\n\tchrome.contextMenus.onClicked.addListener(function(data) {\n\n\t\tif(data.menuItemId === 'recoverEditable') {\n\t\t\tchrome.tabs.query({currentWindow: true, active: true}, function(tabs) {\n\t\t\t\tchrome.tabs.sendMessage(tabs[0].id, {action: 'openQuickAccess'});\n\t\t\t});\n\n\t\t} else if(data.menuItemId === 'openRecoveryDialog') {\n\t\t\tchrome.tabs.query({currentWindow: true, active: true}, function(tabs) {\n\t\t\t\tchrome.tabs.sendMessage(tabs[0].id, {action: 'openRecoveryDialog'});\n\t\t\t});\n\t\t}\n\t});\n})();\n","\nchrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {\n    if(request.action === 'openSettings') {\n        let url = chrome.runtime.getURL('html/app.html') + (request.hash || '');\n        chrome.tabs.create({\n            url: url\n        })\n    }\n});","(function() {\n\n\t// Disable splash!\n\t// return;\n\n\n\t// Changing this number will make splash screen appear after update installation\n\tconst SPLASH_VERSION = \"4.0.1\";\n\n\tchrome.runtime.onInstalled.addListener(function(details) {\n\t\tif(details.reason === 'update') {\n\t\t\tchrome.storage.sync.get('splashVersion', obj => {\n\t\t\t\tif(!obj.hasOwnProperty('splashVersion') || obj.splashVersion !== SPLASH_VERSION) {\n\t\t\t\t\tconst url = chrome.runtime.getURL('html/splash.html');\n\t\t\t\t\tchrome.tabs.create({\n\t\t\t\t\t\turl: url\n\t\t\t\t\t})\n\t\t\t\t\t// chrome.storage.sync.set({ splashVersion: SPLASH_VERSION });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t})\n\t\n})();","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const defaultOptions = {};\n\nvar def = {}\n\ndef.savePasswords = false;\ndef.saveCreditCards = false;\ndef.storageTimeDays = 30;\ndef.saveIndicator = 'disable';\ndef.saveIndicatorColor = '#3CB720';\ndef.hideSmallEntries = true;\ndef.keybindEnabled = true;\ndef.quickAccessButtonEnabled = true;\ndef.quickAccessButtonTrigger = 'focus';\ndef.cloneOnRestore = false;\ndef.resetEditablesBetweenRestorations = false;\ndef.qaGroupSessions = true;\ndef.qaEnableSessionSubmenu = true;\ndef.hideContextItems = false;\n\n/// TODO: window access is not available in manifest v3\n// Mac specific\n// if(window.navigator.platform.toLowerCase().indexOf('mac') !== -1) {\n\t// def.keybindToggleRecDiag = 'Control + Backspace';\n\t// def.keybindRestorePreviousSession = 'Control + Alt + Backspace';\n\t// def.keybindOpenQuickAccess = 'Control + r';\n\n// Windows and everything else\n// } else {\n\tdef.keybindToggleRecDiag = 'Alt + Backspace';\n\tdef.keybindRestorePreviousSession = 'Shift + Alt + Backspace';\n\tdef.keybindOpenQuickAccess = 'Alt + r';\n// }\n\n\n\n\ndefaultOptions.get = function(opt) {\n\treturn opt in def ? def[opt] : undefined\n}\n\ndefaultOptions.getAll = function() {\n\treturn JSON.parse(JSON.stringify(def))\n}\n\n\nexport default defaultOptions;","import defaultOptions from '../../modules/options/defaultOptions';\n\n// chrome.idle.setDetectionInterval(15); // seconds\nchrome.idle.setDetectionInterval(60); // seconds\nchrome.idle.onStateChanged.addListener(function(state) {\n\tif(state === 'idle') {\n\t\tchrome.storage.local.get('DBMaintenanceTimestamp', function(res) {\n\t\t\tlet lastrun = res.DBMaintenanceTimestamp || 0;\n\n\t\t\tif(Date.now() - lastrun > 43200000) { // 12 hours\n\t\t\t\tconsole.log('Is idle, running maintenance')\n\t\t\t\trunMaintenance();\n\t\t\t\tchrome.storage.local.set({ DBMaintenanceTimestamp: Date.now() });\n\t\t\t} else {\n\t\t\t\tconsole.log('Is idle but maintenance has already been ran.')\n\t\t\t}\n\t\t})\n\t}\n});\n\nfunction runMaintenance() {\n\n\tchrome.storage.sync.get('storageTimeDays', function(data) {\n\t\tlet maxdays = data.hasOwnProperty('storageTimeDays') ? data['storageTimeDays'] : defaultOptions.get('storageTimeDays');\n\t\tlet expirepoint = (Date.now()/1000) - (maxdays * 86400);\n\n\t\t// Delete old stuff\n\t\tchrome.storage.local.get(null, function(data) {\n\n\t\t\t// Loop through all domains in storage\n\n\t\t\tfor(let domain in data) {\n\t\t\t\tif(domain.indexOf('###') !== 0 || !data[domain].hasOwnProperty('fields')) continue;\n\t\t\t\tlet action = 'ignore';\n\n\t\t\t\t// console.log('data for', domain, JSON.parse(JSON.stringify(data[domain])))\n\n\t\t\t\t// If empty domain (nothing stored in domain)\n\t\t\t\tif(Object.keys(data[domain].fields) < 1) {\n\t\t\t\t\taction = 'delete';\n\n\t\t\t\t} else {\n\t\t\t\t\tfor(let fieldId in data[domain].fields) {\n\n\t\t\t\t\t\t// Loop through every session id per field\n\t\t\t\t\t\tfor(let sessionId in data[domain].fields[fieldId].sess) {\n\t\t\t\t\t\t\tif(sessionId < expirepoint) {\n\n\t\t\t\t\t\t\t\t// console.log(sessionId, data[domain].fields[fieldId].sess[sessionId])\n\n\t\t\t\t\t\t\t\t// Delete entry\n\t\t\t\t\t\t\t\tdelete data[domain].fields[fieldId].sess[sessionId];\n\n\t\t\t\t\t\t\t\t// Delete entire field if empty\n\t\t\t\t\t\t\t\tif(Object.keys(data[domain].fields[fieldId].sess).length < 1) {\n\t\t\t\t\t\t\t\t\tdelete data[domain].fields[fieldId]\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\taction = 'save';\n\n\t\t\t\t\t\t\t\t// Delete entire field if empty\n\t\t\t\t\t\t\t\tif(Object.keys(data[domain].fields).length < 1) {\n\t\t\t\t\t\t\t\t\taction = 'delete';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Write changes\n\t\t\t\tif(action === 'save') {\n\t\t\t\t\tconsole.log('maintenance run on', domain/*, JSON.parse(JSON.stringify(data[domain]))*/);\n\t\t\t\t\tchrome.storage.local.set({[domain]: data[domain]});\n\n\t\t\t\t} else if(action === 'delete') {\n\t\t\t\t\tconsole.log('maintenance deleted', domain)\n\t\t\t\t\tchrome.storage.local.remove(domain);\n\t\t\t\t}\n\t\t\t}\n\n\t\t});\n\t});\n}\n","// Controllers\nimport './listenerController.js';\nimport './maintenanceController.js';\nimport './contextMenuController.js';\nimport './splashController.js';\n\n\n// In case i need it for future stuff\nchrome.storage.sync.set({version: 2});\n// chrome.storage.local.clear();\n\n// chrome.tabs.create({\n//     url: 'chrome-extension://lpbjhmjpobgjcacflfibadcfimmbpmal/html/app.html#/database-manager',\n// })"],"names":["createContextMenus","chrome","contextMenus","create","id","title","contexts","runtime","onInstalled","addListener","storage","sync","get","obj","hideContextItems","onChanged","changes","namespace","newValue","removeAll","onClicked","data","menuItemId","tabs","query","currentWindow","active","sendMessage","action","onMessage","request","sender","sendResponse","url","getURL","hash","details","reason","hasOwnProperty","splashVersion","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","defaultOptions","def","opt","getAll","JSON","parse","stringify","idle","setDetectionInterval","onStateChanged","state","local","res","lastrun","DBMaintenanceTimestamp","Date","now","maxdays","expirepoint","domain","indexOf","Object","keys","fields","fieldId","sessionId","sess","length","set","remove","version"],"sourceRoot":""}