{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://typio-form-recovery/./src/js/modules/blacklist.js","webpack://typio-form-recovery/./src/js/controllers/popupController/popupController.js"],"sourcesContent":["const blacklist = {};\n\nblacklist.getAll = function(callback) {\n\tgetOptionData(callback)\n}\n\nblacklist.blockDomain = function(domain, callback) {\n\tgetOptionData(function(list) {\n\t\tif(isBlocked(list, domain) === false) {\n\t\t\tlist.push(domain);\n\t\t\tsaveList(list);\n\t\t\tif(callback) callback(list);\n\t\t}\n\t});\n}\n\nblacklist.unblock = function(url, callback) {\n\tgetOptionData(function(list) {\n\t\tlet index = isBlocked(list, url);\n\t\tif(index !== false) {\n\t\t\tlist.splice(index, 1);\n\t\t\tsaveList(list, callback);\n\t\t}\n\t});\n}\n\nblacklist.isBlocked = function(url, callback) {\n\tgetOptionData(function(list) {\n\t\tcallback(isBlocked(list, url) !== false );\n\t});\n}\n\nfunction isBlocked(list, url) {\n\n\tlet index = list.indexOf(url);\n\tif(index !== -1) return index;\n\n\ttry {\n\t\t// Full URL was passed\n\t\tlet urlObj = new URL(url);\n\n\t\t// Check if hostname is blocked\n\t\tlet index = list.indexOf(urlObj.hostname);\n\t\tif(index !== -1) return index;\n\n\n\t\t// Loop through items and compare individually\n\t\tfor(let pi in list) {\n\t\t\tlet pattern = list[pi];\n\n\t\t\t// Regex\n\t\t\tlet regex = isRegex(pattern);\n\t\t\tif(regex !== false) {\n\t\t\t\tif(regex.test(url)) {\n\t\t\t\t\treturn pi;\n\t\t\t\t}\n\n\t\t\t\t// Wildcard\n\t\t\t} else if(pattern.indexOf('*') !== -1) {\n\t\t\t\tlet wild = wildcardCheck(pattern, urlObj.hostname);\n\t\t\t\tif(wild) return pi;\n\t\t\t}\n\t\t}\n\n\t\t// Domain was passed instead of URL\n\t} catch(e) {\n\n\t\tlet domain = url;\n\n\t\tlet index = list.indexOf(domain);\n\t\tif(index !== -1) return index;\n\n\t\tfor(let pi in list) {\n\t\t\t// Wildcard\n\t\t\tif(list[pi].indexOf('*') !== -1) {\n\t\t\t\tlet wild = wildcardCheck(list[pi], domain);\n\t\t\t\tif(wild) return pi;\n\t\t\t}\n\t\t}\n\t}\n\n\n\tfunction wildcardCheck(pattern, hostname) {\n\t\ttry {\n\t\t\tlet regex = new RegExp( pattern.replace('.', '\\.?').replace('*', '.*?') );\n\t\t\tif(regex.test(hostname)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch(e){}\n\t}\n\n\n\treturn false;\n}\n\nfunction isRegex(string) {\n\tif(string.length > 3 && string.indexOf('/') === 0 && string.slice(-1) === '/') {\n\t\tlet tmp = string.substring(1, string.length-1);\n\t\ttry {\n\t\t\treturn new RegExp(tmp);\n\t\t} catch(e) {}\n\t}\n\treturn false;\n}\n\nfunction saveList(list, callback) {\n\tchrome.storage.sync.set({'domainBlacklist': list}, function(set) {\n\t\tif(callback) callback(list);\n\t});\n}\n\n\nfunction getOptionData(callback) {\n\tchrome.storage.sync.get('domainBlacklist', function(data) {\n\t\tdata = convertLegacy(data['domainBlacklist']);\n\t\tcallback(data);\n\t})\n}\n\n\n// Old blacklist was saved as a big text field with one domain per line\n// If the old format is still used, this function converts the data\n// into array format.\nfunction convertLegacy(blob) {\n\n\t// Empty array or string or null\n\tif(!blob) {\n\t\treturn [];\n\n\t\t// If string, convert to array\n\t} else if(typeof blob === 'string') {\n\t\tblob = (blob + \"\").split(/[\\r|\\n]+/g).filter(word => word.trim().length > 0);\n\t\treturn blob;\n\n\t\t// Already array\n\t} else {\n\t\treturn blob;\n\t}\n}\n\nexport default blacklist;","import '../../../sass/popup.scss';\nimport blacklist from '../../modules/blacklist'\n\nlet hostnamePlaceholder = document.querySelector('.js-hostname'),\n\tblacklistToggleBtn = document.querySelector('.head-toggle'),\n\turlObj;\n\ndocument.addEventListener('click', async function(e) {\n\te.preventDefault();\n\n\tlet target = e.target;\n\n\t// Open recovery link\n\tif(target.classList.contains('open-recovery-link')) {\n\t\tlet queryOptions = { active: true, currentWindow: true };\n\t  // `tab` will either be a `tabs.Tab` instance or `undefined`.\n  \tconst [tab] = await chrome.tabs.query(queryOptions);\n\n\t\tchrome.tabs.sendMessage(tab.id, { action: 'openRecoveryDialog' });\n\n\t// Open options link\n\t} else if(target.classList.contains('open-options-link')) {\n\t\tchrome.runtime.openOptionsPage();\n\n\t// Show key combos\n\t} else if(target.classList.contains('open-keyboard-shortcuts')) {\n\t\tchrome.tabs.query({active: true, currentWindow: true}, function(tabs) {\n\t\t\tchrome.tabs.sendMessage(tabs[0].id, {action: 'showKeyboardShortcuts'});\n\t\t});\n\n\t// Delete all link\n\t} else if(target.classList.contains('delete-all-link')) {\n\t\tif(target.classList.contains('confirm-click')) {\n\t\t\tchrome.tabs.query({active: true, currentWindow: true}, function(tabs) {\n\t\t\t\tchrome.tabs.sendMessage(tabs[0].id, {action: 'clearData'});\n\n\t\t\t\ttarget.innerHTML = 'Data has been deleted';\n\t\t\t\ttarget.classList.remove('confirm-click');\n\t\t\t\ttarget.classList.add('green');\n\t\t\t\ttarget.classList.remove('delete-all-link'); // Disable this action on link\n\t\t\t});\n\t\t} else {\n\t\t\ttarget.classList.add('confirm-click');\n\t\t\ttarget.innerHTML = 'Click again to confirm deletion of all data on ' + urlObj.hostname + '. Deletion cannot be undone.';\n\t\t}\n\n\t} else if(target.classList.contains('donate-link')) {\n\t\twindow.open('https://www.buymeacoffee.com/typio');\n\n\t} else if(target.classList.contains('feedback-link')) {\n\t\tchrome.runtime.sendMessage({ action: 'openSettings', hash: '#/feedback' });\n\n\t} else if(target.classList.contains('faq-link')) {\n\t\tchrome.runtime.sendMessage({ action: 'openSettings', hash: '#/faq' });\n\t}\n})\n\n\n\n\n// Get hostname for current tab\nchrome.tabs.query({active: true, currentWindow: true}, function(tabs) {\n\turlObj = new URL(tabs[0].url);\n\n\thostnamePlaceholder.innerHTML = urlObj.hostname;\n\n\tblacklist.isBlocked(urlObj.href, function(bool) {\n\t\tif(bool) {\n\t\t\tblacklistToggleBtn.classList.remove('is-enabled');\n\t\t}\n\t})\n});\n\n\n\n// Toggle blacklist button\nblacklistToggleBtn.addEventListener('mousedown', function(e) {\n\n\t// Add to blacklist\n\tif(blacklistToggleBtn.classList.contains('is-enabled')) {\n\t\tblacklist.blockDomain(urlObj.hostname);\n\n\t// Remove from blacklist\n\t} else {\n\t\tblacklist.unblock(urlObj.href);\n\n\t}\n\n\tblacklistToggleBtn.classList.toggle('is-enabled');\n});\n"],"names":["blacklist","isBlocked","list","url","index","indexOf","urlObj","URL","hostname","pi","pattern","regex","isRegex","test","wildcardCheck","e","domain","RegExp","replace","string","length","slice","tmp","substring","saveList","callback","chrome","storage","sync","set","getOptionData","get","data","blob","split","filter","word","trim","getAll","blockDomain","push","unblock","splice","hostnamePlaceholder","document","querySelector","blacklistToggleBtn","addEventListener","async","preventDefault","target","classList","contains","queryOptions","active","currentWindow","tab","tabs","query","sendMessage","id","action","runtime","openOptionsPage","innerHTML","remove","add","window","open","hash","href","bool","toggle"],"sourceRoot":""}