{"version":3,"file":"content.frameInjector.js","mappings":"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","sources":["webpack://typio-form-recovery/./src/js/modules/Cache.js","webpack://typio-form-recovery/./src/js/modules/Helpers.js","webpack://typio-form-recovery/./src/js/modules/PathGenerator.js","webpack://typio-form-recovery/./src/js/controllers/content.frameInjector/frameInjectorController.js"],"sourcesContent":["let exports = {};\n\nlet storageData = {},\n\tstorageKeys = [];\n\nexports.cache = function(key, cacheFunction) {\n\tlet keyId = storageKeys.indexOf(key);\n\tif(keyId !== -1) {\n\t\treturn storageData[keyId]\n\t}\n\n\tkeyId = storageKeys.push(key) -1;\n\tstorageData[keyId] = cacheFunction();\n\n\treturn storageData[keyId];\n};\n\nexports.wipeCache = function() {\n\tstorageData = {};\n\tstorageKeys = [];\n}\n\nexport default exports;","let exp = {};\n\nexp.hashStr = function(str) {\n\tvar hash = 0;\n\tif (str.length == 0) return hash;\n\tfor (var i = 0; i < str.length; i++) {\n\t\tvar char = str.charCodeAt(i);\n\t\thash = ((hash<<5)-hash)+char;\n\t\thash = hash & hash;\n\t}\n\treturn hash;\n}\n\nexp.trim = function(str) {\n\tstr = str.replace(/[^\\S\\r\\n]+/g, ' ').replace(/[\\r\\n]+/g, '\\r\\n');\n\treturn str.trim();\n}\n\nexp.trimNewLines = function(str) {\n\treturn str.replace(/[\\r\\n]/g, '');\n}\n\nexp.stripTags = (() => {\n\tvar tmp = document.createElement('div');\n\treturn (html) => {\n\t\ttmp.innerHTML = html;\n\t\t\n\t\t// Delete <noscript> tags, they can contain HTML and it is not removed by this method\n\t\tconst noscripts = tmp.querySelectorAll('noscript');\n\t\tfor(const noscript of noscripts) {\n\t\t\tnoscript.parentNode.removeChild(noscript);\n\t\t}\n\n\t\treturn tmp.textContent;\n\t}\n})();\n\n// https://stackoverflow.com/a/47192491/290790\nexp.encodeHTMLEntities = (function() {\n\tvar doc = document.implementation.createDocument(\"\", \"\", null),\n\t\tel = doc.createElement(\"terafmXMLTemp\");\n\tel.textContent = \"terafmXMLTemp\";\n\tel = el.firstChild;\n\tvar ser =  new XMLSerializer();\n\treturn function(str) {\n\t\tel.nodeValue = str;\n\t\treturn ser.serializeToString(el);\n\t};\n})();\n\nexp.decodeHTMLEntities = function(str) {\n\tvar parser = new DOMParser,\n\t\tdom = parser.parseFromString('<!doctype html><body>' + str, 'text/html');\n\n\treturn dom.body.textContent.trim();\n}\n\n// exp.escapeRegExp = function(str) {\n// \treturn str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n// }\n\nexp.cloneObject = function(orgObj) {\n\treturn Object.assign({}, orgObj);\n}\n\nexp.prettyDateFromTimestamp = function(timestamp) {\n\tvar timezoneOffsetMs =  (new Date()).getTimezoneOffset() * 60000,\n\t\tdate =  new Date( (timestamp*1000) - timezoneOffsetMs ),\n\t\tpretty = exp.prettyDate(date.toISOString());\n\n\tif(!pretty) {\n\t\treturn date.toLocaleDateString('en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric'\n\t\t});\n\t}\n\n\treturn pretty;\n}\n\nexp.prettyDate = function(time) {\n\tvar date = new Date((time || \"\").replace(/-/g, \"/\").replace(/[TZ]/g, \" \")),\n\tdiff = (((new Date()).getTime() - date.getTime()) / 1000),\n\tday_diff = Math.floor(diff / 86400);\n\n\tif (isNaN(day_diff) || day_diff < 0 || day_diff >= 31) return;\n\n\tif(day_diff == 1) {\n\t\treturn 'Yesterday at ' + date.getHours() + ':' + date.getMinutes();\n\t}\n\n\treturn day_diff == 0 && (diff < 60 && \"Just now\" || diff < 120 && \"1 minute ago\" || diff < 3600 && Math.floor(diff / 60) + \" minutes ago\" || diff < 7200 && \"1 hour ago\" || diff < 86400 && Math.floor(diff / 3600) + \" hours ago\");\n}\n\n\nexp.copyToClipboard = function(text) {\n\tvar textarea = document.createElement('textarea');\n\ttextarea.innerHTML = text;\n\ttextarea.setAttribute('class', 'typioIgnoreField');\n\tdocument.body.appendChild(textarea);\n\ttextarea.select();\n\n\tvar result = document.execCommand('copy');\n\tdocument.body.removeChild(textarea)\n\treturn result;\n}\n\n\n\n// https://davidwalsh.name/javascript-debounce-function\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The exp.will = function be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the exp.on = function the\n// leading edge, instead of the trailing.\n/*\nexp.debounce = function(func, wait, immediate, after) {\n\tvar timeout;\n\treturn function() {\n\t\tvar context = this, args = arguments;\n\t\tvar later = function() {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate || after) func.apply(context, args);\n\t\t};\n\t\tvar callNow = immediate && !timeout;\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n}\n*/\n\n// From underscore.js\n// Found here: https://stackoverflow.com/a/27078401/290790\nexp.throttle = function(func, wait, options) {\n\tvar context, args, result;\n\tvar timeout = null;\n\tvar previous = 0;\n\tif (!options) options = {};\n\tvar later = function() {\n\t\tprevious = options.leading === false ? 0 : Date.now();\n\t\ttimeout = null;\n\t\tresult = func.apply(context, args);\n\t\tif (!timeout) context = args = null;\n\t};\n\treturn function() {\n\t\tvar now = Date.now();\n\t\tif (!previous && options.leading === false) previous = now;\n\t\tvar remaining = wait - (now - previous);\n\t\tcontext = this;\n\t\targs = arguments;\n\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\tif (timeout) {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = null;\n\t\t\t}\n\t\t\tprevious = now;\n\t\t\tresult = func.apply(context, args);\n\t\t\tif (!timeout) context = args = null;\n\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\ttimeout = setTimeout(later, remaining);\n\t\t}\n\t\treturn result;\n\t};\n};\n\nexp.prettyKeys = function(keyarr) {\n\n\tfor(var ki in keyarr) {\n\t\tkeyarr[ki] = '<span class=\"key\">' + keyarr[ki] + '</span> '\n\t}\n\n\treturn keyarr.join(' + ')\n\n}\n\n/**\n * Returns the target for the given event\n * @export\n * @param {Event} event\n * @returns {EventTarget | null}\n */\nexport function getEventTarget(event) {\n\t// event.path has been deprecated in Chrome 109 (Jan. 2023)\n\t// https://chromestatus.com/feature/5726124632965120\n\tif (event.composedPath) {\n\t\treturn event.composedPath()[0];\n\t}\n\telse {\n\t\t// console.trace()\n\t\t// console.error(\"composedPath not found on event\")\n\t\treturn null\n\t}\n}\n\nexport default exp;\n\n\n","\n\n// Heavily modified from: https://stackoverflow.com/a/16742828/290790\n// Careful cause changing this will result in editableID's changing\n// which results in entries not being shown in context menu\nexport default function(el) {\n\n\t// Cannot break out of capsules, return fake path\n\ttry{window.top.document} catch(e) {\n\t\treturn generateFakePath();\n\t}\n\n\tvar parentCapsule = getParentCapsule(el), // Will change as it breaks out\n\t\tisEncapsulated = parentCapsule ? true : false,\n\t\tisShadow = false;\n\n\tvar stack = [],\n\t\tprevEl;\n\n\twhile(el) {\n\n\t\t// console.log('curr el', el);\n\n\t\t// If top body, stop\n\t\tif(el === window.top.document.body) {\n\t\t\tstack.unshift('body');\n\t\t\tbreak;\n\t\t}\n\n\n\t\t// If capsule\n\t\tif(el === parentCapsule) {\n\n\t\t\t// console.log('reached capsule', el)\n\n\t\t\t// Shadow root. Add nothing to stack, break out\n\t\t\tif(el.toString() === '[object ShadowRoot]') {\n\t\t\t\tel = el.host;\n\t\t\t\tisShadow = true;\n\t\t\t}\n\n\t\t\t// Iframe body. Add to stack, break out\n\t\t\telse if(el.ownerDocument.defaultView.frameElement) {\n\t\t\t\tel  = el.ownerDocument.defaultView.frameElement;\n\t\t\t}\n\n\t\t\t// Find next parent capsule\n\t\t\tparentCapsule = getParentCapsule(el);\n\t\t\t// console.log('next parent capsule is', parentCapsule)\n\n\t\t\tcontinue;\n\t\t}\n\n\n\t\t// If el has ID\n\t\tif(el.id && el.id.length > 1 /*&& el.id.match(/^[a-z0-9._-]+$/i) !== null*/) {\n\n\t\t\tlet escId = CSS.escape(el.id);\n\n\t\t\t// var idCount = el.ownerDocument.querySelectorAll('#' + el.id);\n\t\t\tvar idCount = el.ownerDocument.querySelectorAll('#'+ escId );\n\n\t\t\t// If not encapsulated, add to stack and stop\n\t\t\tif(!isEncapsulated && idCount.length === 1) {\n\t\t\t\tstack.unshift('#' + escId);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// If encapsulated, add to stack and break out\n\t\t\telse if(idCount.length === 1) {\n\t\t\t\tvar nodeName = '#' + escId;\n\t\t\t\tif(isShadow) {\n\t\t\t\t\tnodeName += '::shadow';\n\t\t\t\t\tisShadow = false;\n\t\t\t\t}\n\t\t\t\tif(el.nodeName === 'IFRAME') {\n\t\t\t\t\tnodeName = 'iframe' + nodeName;\n\t\t\t\t}\n\t\t\t\tstack.unshift(nodeName);\n\n\t\t\t\tif(parentCapsule) {\n\t\t\t\t\tif(parentCapsule.toString() === '[object ShadowRoot]') {\n\t\t\t\t\t\tel = parentCapsule.host;\n\t\t\t\t\t\tisShadow = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tel = parentCapsule.ownerDocument.defaultView.frameElement;\n\t\t\t\t\t}\n\t\t\t\t\tparentCapsule = getParentCapsule(el);\n\t\t\t\t} else {\n\t\t\t\t\tel = el.parentNode;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\n\t\tvar nodeName = el.nodeName.toLowerCase();\n\n\t\tvar sibIndex = getSiblingIndex(el);\n\t\tif(sibIndex !== false) {\n\t\t\tnodeName += ':nth-of-type(' + (sibIndex) + ')';\n\t\t}\n\t\tif(isShadow) {\n\t\t\tnodeName += '::shadow';\n\t\t\tisShadow = false;\n\t\t}\n\n\t\tstack.unshift(nodeName);\n\t\tel = el.parentNode;\n\t}\n\n\n\tstack = stack.join(' > ');\n\n\treturn stack;\n}\n\nfunction generateFakePath() {\n\treturn '#unidentified-' + Math.round(Math.random()*10000000);\n}\n\nfunction getSiblingIndex(el) {\n\tvar sibCount = 0;\n\tvar sibIndex = 0;\n\n\t// get sibling indexes\n\tfor ( var i = 0; i < el.parentNode.childNodes.length; i++ ) {\n\t\tvar sib = el.parentNode.childNodes[i];\n\t\tif ( sib.nodeName == el.nodeName ) {\n\t\t\tif ( sib === el ) {\n\t\t\t\tsibIndex = sibCount;\n\t\t\t}\n\t\t\tsibCount++;\n\t\t}\n\t}\n\n\treturn sibCount > 1 ? sibIndex+1 : false;\n}\n\nfunction getParentCapsule(node) {\n\tlet caps = getParentShadowHost(node) || getParentIframe(node) || false;\n\t// console.log('parent capsule', caps);\n\treturn caps;\n}\n\nfunction getParentShadowHost(node) {\n\n\t// Is in shadow DOM?\n\tfor (; node; node = node.parentNode) {\n\t\tif (node.toString() === \"[object ShadowRoot]\") {\n\t\t\treturn node;\n\t\t}\n\t}\n}\n\nfunction getParentIframe(node) {\n\n\t// Is in iframe?\n\t// console.dir(node);\n\tif(node.ownerDocument && node.ownerDocument.defaultView.frameElement) {\n\t\treturn node.ownerDocument.documentElement;\n\t}\n}\n\nfunction getCapsuleHost(node) {\n\tif(node.ownerDocument.defaultView.frameElement) {\n\t\treturn node.ownerDocument.defaultView.frameElement;\n\t} else if(node.host) {\n\t\treturn node.host;\n\t}\n}","import Cache from '../../modules/Cache';\nimport { getEventTarget } from '../../modules/Helpers';\nimport PathGenerator from '../../modules/PathGenerator';\n\n// Run only in child frames\nif(window !== window.top) {\n\n\tconst events = [\n\t\t{ name: 'input' },\n\t\t{ name: 'keyup', capture: true },\n\t\t{ name: 'contextmenu' },\n\t\t{ name: 'mousedown' },\n\t\t{ name: 'click' },\n\t\t{ name: 'dblclick' },\n\t\t{ name: 'focus', capture: true },\n\t\t{ name: 'blur', capture: true },\n\t\t{ name: 'change', capture: true },\n\t\t{ name: 'keydown', capture: true },\n\t];\n\n\tfunction eventHandler(e) {\n\t\tconst target = getEventTarget(e);\n\n\t\tconsole.log(\"TARGETTTT\", { target })\n\t\tif (!target) return;\n\n\t\tlet msg = {\n\t\t\taction: 'terafmEventCatcher',\n\n\t\t\t// Was previously only \"event\", but this caused videos to not play on digg.com because there\n\t\t\t// is an event listener and if the object isn't valid (according to them) they reload the page.\n\t\t\t// They listen for a \"msg.event\", so if we rename that to be unique that resolves the issue.\n\t\t\tterafmEvent: {\n\t\t\t\tpath: [Cache.cache(target, () => PathGenerator(target))],\n\t\t\t\ttype: e.type\n\t\t\t}\n\t\t}\n\t\n\t\t// Special case for to send mouse coordinates\n\t\tif(e.type === 'contextmenu') {\n\t\t\tmsg.terafmEvent.pageX = e.pageX;\n\t\t\tmsg.terafmEvent.pageY = e.pageY;\n\t\t} else if(e.type === 'keydown') {\n\t\t\tmsg.terafmEvent.key = e.key;\n\t\t} else if(e.type === 'keyup') {\n\t\t\tmsg.terafmEvent.keyCode = e.keyCode;\n\t\t}\n\t\n\t\twindow.top.postMessage(msg, '*');\n\t}\n\n\tfunction attachListeners() {\n\t\tfor(const event of events) {\n\t\t\tdocument.addEventListener(event.name, eventHandler, event.capture);\n\t\t}\n\t}\n\n\tattachListeners();\n\t\n\t// Wrapped in a timeout because some apps (like http://qiyukf.com/) does some wonky shit\n\t// to the DOM after document load and the event listeners were not attached.\n\tsetTimeout(attachListeners, 20);\n}\n"],"names":["storageData","storageKeys","cache","key","cacheFunction","keyId","indexOf","push","wipeCache","exp","tmp","hashStr","str","hash","length","i","charCodeAt","trim","replace","trimNewLines","stripTags","document","createElement","html","innerHTML","noscripts","querySelectorAll","noscript","parentNode","removeChild","textContent","encodeHTMLEntities","el","implementation","createDocument","firstChild","ser","XMLSerializer","nodeValue","serializeToString","decodeHTMLEntities","DOMParser","parseFromString","body","cloneObject","orgObj","Object","assign","prettyDateFromTimestamp","timestamp","timezoneOffsetMs","Date","getTimezoneOffset","date","pretty","prettyDate","toISOString","toLocaleDateString","year","month","day","hour","minute","time","diff","getTime","day_diff","Math","floor","isNaN","getHours","getMinutes","copyToClipboard","text","textarea","setAttribute","appendChild","select","result","execCommand","throttle","func","wait","options","context","args","timeout","previous","later","leading","now","apply","remaining","this","arguments","clearTimeout","trailing","setTimeout","prettyKeys","keyarr","ki","join","window","top","e","round","random","parentCapsule","getParentCapsule","isEncapsulated","isShadow","stack","unshift","id","escId","CSS","escape","idCount","ownerDocument","nodeName","toString","host","defaultView","frameElement","toLowerCase","sibIndex","getSiblingIndex","sibCount","childNodes","sib","node","caps","getParentShadowHost","documentElement","getParentIframe","events","name","capture","eventHandler","target","event","composedPath","msg","action","terafmEvent","path","Cache","PathGenerator","type","pageX","pageY","keyCode","postMessage","attachListeners","addEventListener"],"sourceRoot":""}